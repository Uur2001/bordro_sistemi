{% extends 'base.html' %}
{% load static %}

{% block title %}Yıllık Bordro Hesaplama{% endblock %}

{% block content %}
<div class="calculation-page">
    <div class="steps-navbar">
        <div class="navbar-container">
            <button class="nav-step active" onclick="showStep(1)" data-step="1">Temel Ücret</button>
            <button class="nav-step" onclick="showStep(2)" data-step="2">Çalışma Bilgileri</button>
            <button class="nav-step" onclick="showStep(3)" data-step="3">Sosyal Güvenlik</button>
            <button class="nav-step" onclick="showStep(4)" data-step="4">Özel Sigortalar</button>
            <button class="nav-step" onclick="showStep(5)" data-step="5">Fazla Mesailer</button>
        </div>
    </div>

    <div class="calculation-container-new">
        <div class="form-content">
            <!-- ADIM 1: TEMEL ÜCRET -->
            <div class="step-content active" id="step1">
                <div class="form-header-bar">
                    <h2>Temel Ücret</h2>
                    <div class="header-right">
                        <select class="header-select">
                            <option>-</option>
                        </select>
                        <div class="action-buttons">
                            <button class="icon-btn green" title="Yeni"><i class="fas fa-plus"></i></button>
                            <button class="icon-btn blue" title="Kaydet"><i class="fas fa-save"></i></button>
                            <button class="icon-btn yellow" title="Düzenle"><i class="fas fa-edit"></i></button>
                            <button class="icon-btn red" title="Sil"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                </div>

                <form class="modern-form">
                    <div class="form-section-content">
                        <div class="yearly-info-row">
                            <div class="yearly-info-item">
                                <label>Bordro Yılı</label>
                                <select class="form-control">
                                    <option selected>2026</option>
                                    <option>2025</option>
                                    <option>2024</option>
                                </select>
                            </div>
                            <div class="yearly-info-item">
                                <label>GV Matrahı</label>
                                <input type="text" class="form-control" value="0,00 ₺">
                            </div>
                            <div class="yearly-info-item">
                                <label>Asg. Ücr. GV Matrahı</label>
                                <input type="text" class="form-control" value="0,00 ₺">
                            </div>
                            <div class="yearly-info-item">
                                <label>SGK Matrahı (2 Ay önce)</label>
                                <input type="text" class="form-control" value="0,00 ₺">
                            </div>
                            <div class="yearly-info-item">
                                <label>SGK Matrahı (1 Ay önce)</label>
                                <input type="text" class="form-control" value="0,00 ₺">
                            </div>
                        </div>

                        <div class="yearly-table">
                            <div class="yearly-header">
                                <div class="col-month">Ay</div>
                                <div class="col-amount">Ücret</div>
                                <div class="col-type">Tipi</div>
                                <div class="col-gv">GV</div>
                                <div class="col-dv">DV</div>
                                <div class="col-engellilik">Engellilik</div>
                            </div>

                            <div class="yearly-row">
                                <div class="col-month"><strong>1. Ocak</strong></div>
                                <div class="col-amount"><input type="text" class="form-control" value="33.030,00 ₺"></div>
                                <div class="col-type">
                                    <select class="form-control">
                                        <option selected>Brüt</option>
                                        <option>Net</option>
                                    </select>
                                </div>
                                <div class="col-gv"><input type="checkbox" checked></div>
                                <div class="col-dv"><input type="checkbox" checked></div>
                                <div class="col-engellilik">
                                    <select class="form-control">
                                        <option selected>Normal</option>
                                        <option>1. Derece</option>
                                        <option>2. Derece</option>
                                        <option>3. Derece</option>
                                    </select>
                                </div>
                            </div>

                            <div class="yearly-row">
                                <div class="col-month"><strong>2. Şubat</strong></div>
                                <div class="col-amount"><input type="text" class="form-control" value="33.030,00 ₺"></div>
                                <div class="col-type">
                                    <select class="form-control">
                                        <option selected>Brüt</option>
                                        <option>Net</option>
                                    </select>
                                </div>
                                <div class="col-gv"><input type="checkbox" checked></div>
                                <div class="col-dv"><input type="checkbox" checked></div>
                                <div class="col-engellilik">
                                    <select class="form-control">
                                        <option selected>Normal</option>
                                        <option>1. Derece</option>
                                        <option>2. Derece</option>
                                        <option>3. Derece</option>
                                    </select>
                                </div>
                            </div>

                            <div class="yearly-row">
                                <div class="col-month"><strong>3. Mart</strong></div>
                                <div class="col-amount"><input type="text" class="form-control" value="33.030,00 ₺"></div>
                                <div class="col-type">
                                    <select class="form-control">
                                        <option selected>Brüt</option>
                                        <option>Net</option>
                                    </select>
                                </div>
                                <div class="col-gv"><input type="checkbox" checked></div>
                                <div class="col-dv"><input type="checkbox" checked></div>
                                <div class="col-engellilik">
                                    <select class="form-control">
                                        <option selected>Normal</option>
                                        <option>1. Derece</option>
                                        <option>2. Derece</option>
                                        <option>3. Derece</option>
                                    </select>
                                </div>
                            </div>

                            <div class="yearly-row">
                                <div class="col-month"><strong>4. Nisan</strong></div>
                                <div class="col-amount"><input type="text" class="form-control" value="33.030,00 ₺"></div>
                                <div class="col-type">
                                    <select class="form-control">
                                        <option selected>Brüt</option>
                                        <option>Net</option>
                                    </select>
                                </div>
                                <div class="col-gv"><input type="checkbox" checked></div>
                                <div class="col-dv"><input type="checkbox" checked></div>
                                <div class="col-engellilik">
                                    <select class="form-control">
                                        <option selected>Normal</option>
                                        <option>1. Derece</option>
                                        <option>2. Derece</option>
                                        <option>3. Derece</option>
                                    </select>
                                </div>
                            </div>

                            <div class="yearly-row">
                                <div class="col-month"><strong>5. Mayıs</strong></div>
                                <div class="col-amount"><input type="text" class="form-control" value="33.030,00 ₺"></div>
                                <div class="col-type">
                                    <select class="form-control">
                                        <option selected>Brüt</option>
                                        <option>Net</option>
                                    </select>
                                </div>
                                <div class="col-gv"><input type="checkbox" checked></div>
                                <div class="col-dv"><input type="checkbox" checked></div>
                                <div class="col-engellilik">
                                    <select class="form-control">
                                        <option selected>Normal</option>
                                        <option>1. Derece</option>
                                        <option>2. Derece</option>
                                        <option>3. Derece</option>
                                    </select>
                                </div>
                            </div>

                            <div class="yearly-row">
                                <div class="col-month"><strong>6. Haziran</strong></div>
                                <div class="col-amount"><input type="text" class="form-control" value="33.030,00 ₺"></div>
                                <div class="col-type">
                                    <select class="form-control">
                                        <option selected>Brüt</option>
                                        <option>Net</option>
                                    </select>
                                </div>
                                <div class="col-gv"><input type="checkbox" checked></div>
                                <div class="col-dv"><input type="checkbox" checked></div>
                                <div class="col-engellilik">
                                    <select class="form-control">
                                        <option selected>Normal</option>
                                        <option>1. Derece</option>
                                        <option>2. Derece</option>
                                        <option>3. Derece</option>
                                    </select>
                                </div>
                            </div>

                            <div class="yearly-row">
                                <div class="col-month"><strong>7. Temmuz</strong></div>
                                <div class="col-amount"><input type="text" class="form-control" value="33.030,00 ₺"></div>
                                <div class="col-type">
                                    <select class="form-control">
                                        <option selected>Brüt</option>
                                        <option>Net</option>
                                    </select>
                                </div>
                                <div class="col-gv"><input type="checkbox" checked></div>
                                <div class="col-dv"><input type="checkbox" checked></div>
                                <div class="col-engellilik">
                                    <select class="form-control">
                                        <option selected>Normal</option>
                                        <option>1. Derece</option>
                                        <option>2. Derece</option>
                                        <option>3. Derece</option>
                                    </select>
                                </div>
                            </div>

                            <div class="yearly-row">
                                <div class="col-month"><strong>8. Ağustos</strong></div>
                                <div class="col-amount"><input type="text" class="form-control" value="33.030,00 ₺"></div>
                                <div class="col-type">
                                    <select class="form-control">
                                        <option selected>Brüt</option>
                                        <option>Net</option>
                                    </select>
                                </div>
                                <div class="col-gv"><input type="checkbox" checked></div>
                                <div class="col-dv"><input type="checkbox" checked></div>
                                <div class="col-engellilik">
                                    <select class="form-control">
                                        <option selected>Normal</option>
                                        <option>1. Derece</option>
                                        <option>2. Derece</option>
                                        <option>3. Derece</option>
                                    </select>
                                </div>
                            </div>

                            <div class="yearly-row">
                                <div class="col-month"><strong>9. Eylül</strong></div>
                                <div class="col-amount"><input type="text" class="form-control" value="33.030,00 ₺"></div>
                                <div class="col-type">
                                    <select class="form-control">
                                        <option selected>Brüt</option>
                                        <option>Net</option>
                                    </select>
                                </div>
                                <div class="col-gv"><input type="checkbox" checked></div>
                                <div class="col-dv"><input type="checkbox" checked></div>
                                <div class="col-engellilik">
                                    <select class="form-control">
                                        <option selected>Normal</option>
                                        <option>1. Derece</option>
                                        <option>2. Derece</option>
                                        <option>3. Derece</option>
                                    </select>
                                </div>
                            </div>

                            <div class="yearly-row">
                                <div class="col-month"><strong>10. Ekim</strong></div>
                                <div class="col-amount"><input type="text" class="form-control" value="33.030,00 ₺"></div>
                                <div class="col-type">
                                    <select class="form-control">
                                        <option selected>Brüt</option>
                                        <option>Net</option>
                                    </select>
                                </div>
                                <div class="col-gv"><input type="checkbox" checked></div>
                                <div class="col-dv"><input type="checkbox" checked></div>
                                <div class="col-engellilik">
                                    <select class="form-control">
                                        <option selected>Normal</option>
                                        <option>1. Derece</option>
                                        <option>2. Derece</option>
                                        <option>3. Derece</option>
                                    </select>
                                </div>
                            </div>

                            <div class="yearly-row">
                                <div class="col-month"><strong>11. Kasım</strong></div>
                                <div class="col-amount"><input type="text" class="form-control" value="33.030,00 ₺"></div>
                                <div class="col-type">
                                    <select class="form-control">
                                        <option selected>Brüt</option>
                                        <option>Net</option>
                                    </select>
                                </div>
                                <div class="col-gv"><input type="checkbox" checked></div>
                                <div class="col-dv"><input type="checkbox" checked></div>
                                <div class="col-engellilik">
                                    <select class="form-control">
                                        <option selected>Normal</option>
                                        <option>1. Derece</option>
                                        <option>2. Derece</option>
                                        <option>3. Derece</option>
                                    </select>
                                </div>
                            </div>

                            <div class="yearly-row">
                                <div class="col-month"><strong>12. Aralık</strong></div>
                                <div class="col-amount"><input type="text" class="form-control" value="33.030,00 ₺"></div>
                                <div class="col-type">
                                    <select class="form-control">
                                        <option selected>Brüt</option>
                                        <option>Net</option>
                                    </select>
                                </div>
                                <div class="col-gv"><input type="checkbox" checked></div>
                                <div class="col-dv"><input type="checkbox" checked></div>
                                <div class="col-engellilik">
                                    <select class="form-control">
                                        <option selected>Normal</option>
                                        <option>1. Derece</option>
                                        <option>2. Derece</option>
                                        <option>3. Derece</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-calculate">
                                <i class="fas fa-calculator"></i> Bordro Hesap
                            </button>
                            <button type="button" class="btn-next" onclick="showStep(2)">
                                Sonraki Adım <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- ADIM 2: ÇALIŞMA BİLGİLERİ -->
            <div class="step-content" id="step2">
                <div class="form-header-bar">
                    <h2>Çalışma Bilgileri</h2>
                    <div class="header-right">
                        <select class="header-select">
                            <option>-</option>
                        </select>
                        <div class="action-buttons">
                            <button class="icon-btn green"><i class="fas fa-plus"></i></button>
                            <button class="icon-btn blue"><i class="fas fa-save"></i></button>
                            <button class="icon-btn yellow"><i class="fas fa-edit"></i></button>
                            <button class="icon-btn red"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                </div>

                <form class="modern-form">
                    <div class="form-section-content">
                        <div class="yearly-table">
                            <div class="yearly-header yearly-header-calisma">
                                <div class="col-month">Ay</div>
                                <div class="col-gun-sayisi">Bir Ay</div>
                                <div class="col-calisilan">Çalışılan Gün</div>
                                <div class="col-eksik">Eksik Saat</div>
                            </div>

                            <div class="yearly-row yearly-row-calisma">
                                <div class="col-month"><strong>1. Ocak</strong></div>
                                <div class="col-gun-sayisi">
                                    <select class="form-control">
                                        <option selected>Takvim Günü</option>
                                        <option>30 Gün</option>
                                    </select>
                                </div>
                                <div class="col-calisilan">
                                    <input type="text" class="form-control" value="31 gün">
                                </div>
                                <div class="col-eksik">
                                    <input type="text" class="form-control" value="0,00 saat">
                                </div>
                            </div>

                            <div class="yearly-row yearly-row-calisma">
                                <div class="col-month"><strong>2. Şubat</strong></div>
                                <div class="col-gun-sayisi">
                                    <select class="form-control">
                                        <option selected>Takvim Günü</option>
                                        <option>30 Gün</option>
                                    </select>
                                </div>
                                <div class="col-calisilan">
                                    <input type="text" class="form-control" value="28 gün">
                                </div>
                                <div class="col-eksik">
                                    <input type="text" class="form-control" value="0,00 saat">
                                </div>
                            </div>

                            <div class="yearly-row yearly-row-calisma">
                                <div class="col-month"><strong>3. Mart</strong></div>
                                <div class="col-gun-sayisi">
                                    <select class="form-control">
                                        <option selected>Takvim Günü</option>
                                        <option>30 Gün</option>
                                    </select>
                                </div>
                                <div class="col-calisilan">
                                    <input type="text" class="form-control" value="31 gün">
                                </div>
                                <div class="col-eksik">
                                    <input type="text" class="form-control" value="0,00 saat">
                                </div>
                            </div>

                            <div class="yearly-row yearly-row-calisma">
                                <div class="col-month"><strong>4. Nisan</strong></div>
                                <div class="col-gun-sayisi">
                                    <select class="form-control">
                                        <option selected>Takvim Günü</option>
                                        <option>30 Gün</option>
                                    </select>
                                </div>
                                <div class="col-calisilan">
                                    <input type="text" class="form-control" value="30 gün">
                                </div>
                                <div class="col-eksik">
                                    <input type="text" class="form-control" value="0,00 saat">
                                </div>
                            </div>

                            <div class="yearly-row yearly-row-calisma">
                                <div class="col-month"><strong>5. Mayıs</strong></div>
                                <div class="col-gun-sayisi">
                                    <select class="form-control">
                                        <option selected>Takvim Günü</option>
                                        <option>30 Gün</option>
                                    </select>
                                </div>
                                <div class="col-calisilan">
                                    <input type="text" class="form-control" value="31 gün">
                                </div>
                                <div class="col-eksik">
                                    <input type="text" class="form-control" value="0,00 saat">
                                </div>
                            </div>

                            <div class="yearly-row yearly-row-calisma">
                                <div class="col-month"><strong>6. Haziran</strong></div>
                                <div class="col-gun-sayisi">
                                    <select class="form-control">
                                        <option selected>Takvim Günü</option>
                                        <option>30 Gün</option>
                                    </select>
                                </div>
                                <div class="col-calisilan">
                                    <input type="text" class="form-control" value="30 gün">
                                </div>
                                <div class="col-eksik">
                                    <input type="text" class="form-control" value="0,00 saat">
                                </div>
                            </div>

                            <div class="yearly-row yearly-row-calisma">
                                <div class="col-month"><strong>7. Temmuz</strong></div>
                                <div class="col-gun-sayisi">
                                    <select class="form-control">
                                        <option selected>Takvim Günü</option>
                                        <option>30 Gün</option>
                                    </select>
                                </div>
                                <div class="col-calisilan">
                                    <input type="text" class="form-control" value="31 gün">
                                </div>
                                <div class="col-eksik">
                                    <input type="text" class="form-control" value="0,00 saat">
                                </div>
                            </div>

                            <div class="yearly-row yearly-row-calisma">
                                <div class="col-month"><strong>8. Ağustos</strong></div>
                                <div class="col-gun-sayisi">
                                    <select class="form-control">
                                        <option selected>Takvim Günü</option>
                                        <option>30 Gün</option>
                                    </select>
                                </div>
                                <div class="col-calisilan">
                                    <input type="text" class="form-control" value="31 gün">
                                </div>
                                <div class="col-eksik">
                                    <input type="text" class="form-control" value="0,00 saat">
                                </div>
                            </div>

                            <div class="yearly-row yearly-row-calisma">
                                <div class="col-month"><strong>9. Eylül</strong></div>
                                <div class="col-gun-sayisi">
                                    <select class="form-control">
                                        <option selected>Takvim Günü</option>
                                        <option>30 Gün</option>
                                    </select>
                                </div>
                                <div class="col-calisilan">
                                    <input type="text" class="form-control" value="30 gün">
                                </div>
                                <div class="col-eksik">
                                    <input type="text" class="form-control" value="0,00 saat">
                                </div>
                            </div>

                            <div class="yearly-row yearly-row-calisma">
                                <div class="col-month"><strong>10. Ekim</strong></div>
                                <div class="col-gun-sayisi">
                                    <select class="form-control">
                                        <option selected>Takvim Günü</option>
                                        <option>30 Gün</option>
                                    </select>
                                </div>
                                <div class="col-calisilan">
                                    <input type="text" class="form-control" value="31 gün">
                                </div>
                                <div class="col-eksik">
                                    <input type="text" class="form-control" value="0,00 saat">
                                </div>
                            </div>

                            <div class="yearly-row yearly-row-calisma">
                                <div class="col-month"><strong>11. Kasım</strong></div>
                                <div class="col-gun-sayisi">
                                    <select class="form-control">
                                        <option selected>Takvim Günü</option>
                                        <option>30 Gün</option>
                                    </select>
                                </div>
                                <div class="col-calisilan">
                                    <input type="text" class="form-control" value="30 gün">
                                </div>
                                <div class="col-eksik">
                                    <input type="text" class="form-control" value="0,00 saat">
                                </div>
                            </div>

                            <div class="yearly-row yearly-row-calisma">
                                <div class="col-month"><strong>12. Aralık</strong></div>
                                <div class="col-gun-sayisi">
                                    <select class="form-control">
                                        <option selected>Takvim Günü</option>
                                        <option>30 Gün</option>
                                    </select>
                                </div>
                                <div class="col-calisilan">
                                    <input type="text" class="form-control" value="31 gün">
                                </div>
                                <div class="col-eksik">
                                    <input type="text" class="form-control" value="0,00 saat">
                                </div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-prev" onclick="showStep(1)">
                                <i class="fas fa-arrow-left"></i> Önceki Adım
                            </button>
                            <button type="button" class="btn-calculate">
                                <i class="fas fa-calculator"></i> Bordro Hesapla
                            </button>
                            <button type="button" class="btn-next" onclick="showStep(3)">
                                Sonraki Adım <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>
            <!-- ADIM 3: SOSYAL GÜVENLİK -->
            <div class="step-content" id="step3">
                <div class="form-header-bar">
                    <h2>Sosyal Güvenlik</h2>
                    <div class="header-right">
                        <select class="header-select">
                            <option>-</option>
                        </select>
                        <div class="action-buttons">
                            <button class="icon-btn green"><i class="fas fa-plus"></i></button>
                            <button class="icon-btn blue"><i class="fas fa-save"></i></button>
                            <button class="icon-btn yellow"><i class="fas fa-edit"></i></button>
                            <button class="icon-btn red"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                </div>

                <form class="modern-form">
    <div class="form-section-content">
        <div class="yearly-table">
            <div class="yearly-header yearly-header-sgk">
                <div class="col-month">Ay</div>
                <div class="col-sgk-tipi">Sosyal Güvenlik Tipi</div>
                <div class="col-kanun">Kanun No</div>
                <div class="col-hy">HY</div>
                <div class="col-bes">BES</div>
            </div>

            <div class="yearly-row yearly-row-sgk">
                <div class="col-month"><strong>1. Ocak</strong></div>
                <div class="col-sgk-tipi">
                    <select class="form-control">
                        {% for kod, tip in sgk_tipleri.items %}
                        <option value="{{ kod }}-{{ tip.Ad }}" {% if kod == '01' %}selected{% endif %}>{{ kod }}-{{ tip.Ad }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-kanun">
                    <select class="form-control">
                        {% for kod, kanun in kanun_kodlari.items %}
                        <option value="{{ kod }}" {% if kod == '00000' %}selected{% endif %}>{{ kod }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-hy"><input type="checkbox" checked></div>
                <div class="col-bes"><input type="checkbox"></div>
            </div>

            <div class="yearly-row yearly-row-sgk">
                <div class="col-month"><strong>2. Şubat</strong></div>
                <div class="col-sgk-tipi">
                    <select class="form-control">
                        {% for kod, tip in sgk_tipleri.items %}
                        <option value="{{ kod }}-{{ tip.Ad }}" {% if kod == '01' %}selected{% endif %}>{{ kod }}-{{ tip.Ad }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-kanun">
                    <select class="form-control">
                        {% for kod, kanun in kanun_kodlari.items %}
                        <option value="{{ kod }}" {% if kod == '00000' %}selected{% endif %}>{{ kod }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-hy"><input type="checkbox" checked></div>
                <div class="col-bes"><input type="checkbox"></div>
            </div>

            <div class="yearly-row yearly-row-sgk">
                <div class="col-month"><strong>3. Mart</strong></div>
                <div class="col-sgk-tipi">
                    <select class="form-control">
                        {% for kod, tip in sgk_tipleri.items %}
                        <option value="{{ kod }}-{{ tip.Ad }}" {% if kod == '01' %}selected{% endif %}>{{ kod }}-{{ tip.Ad }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-kanun">
                    <select class="form-control">
                        {% for kod, kanun in kanun_kodlari.items %}
                        <option value="{{ kod }}" {% if kod == '00000' %}selected{% endif %}>{{ kod }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-hy"><input type="checkbox" checked></div>
                <div class="col-bes"><input type="checkbox"></div>
            </div>

            <div class="yearly-row yearly-row-sgk">
                <div class="col-month"><strong>4. Nisan</strong></div>
                <div class="col-sgk-tipi">
                    <select class="form-control">
                        {% for kod, tip in sgk_tipleri.items %}
                        <option value="{{ kod }}-{{ tip.Ad }}" {% if kod == '01' %}selected{% endif %}>{{ kod }}-{{ tip.Ad }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-kanun">
                    <select class="form-control">
                        {% for kod, kanun in kanun_kodlari.items %}
                        <option value="{{ kod }}" {% if kod == '00000' %}selected{% endif %}>{{ kod }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-hy"><input type="checkbox" checked></div>
                <div class="col-bes"><input type="checkbox"></div>
            </div>

            <div class="yearly-row yearly-row-sgk">
                <div class="col-month"><strong>5. Mayıs</strong></div>
                <div class="col-sgk-tipi">
                    <select class="form-control">
                        {% for kod, tip in sgk_tipleri.items %}
                        <option value="{{ kod }}-{{ tip.Ad }}" {% if kod == '01' %}selected{% endif %}>{{ kod }}-{{ tip.Ad }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-kanun">
                    <select class="form-control">
                        {% for kod, kanun in kanun_kodlari.items %}
                        <option value="{{ kod }}" {% if kod == '00000' %}selected{% endif %}>{{ kod }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-hy"><input type="checkbox" checked></div>
                <div class="col-bes"><input type="checkbox"></div>
            </div>

            <div class="yearly-row yearly-row-sgk">
                <div class="col-month"><strong>6. Haziran</strong></div>
                <div class="col-sgk-tipi">
                    <select class="form-control">
                        {% for kod, tip in sgk_tipleri.items %}
                        <option value="{{ kod }}-{{ tip.Ad }}" {% if kod == '01' %}selected{% endif %}>{{ kod }}-{{ tip.Ad }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-kanun">
                    <select class="form-control">
                        {% for kod, kanun in kanun_kodlari.items %}
                        <option value="{{ kod }}" {% if kod == '00000' %}selected{% endif %}>{{ kod }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-hy"><input type="checkbox" checked></div>
                <div class="col-bes"><input type="checkbox"></div>
            </div>

            <div class="yearly-row yearly-row-sgk">
                <div class="col-month"><strong>7. Temmuz</strong></div>
                <div class="col-sgk-tipi">
                    <select class="form-control">
                        {% for kod, tip in sgk_tipleri.items %}
                        <option value="{{ kod }}-{{ tip.Ad }}" {% if kod == '01' %}selected{% endif %}>{{ kod }}-{{ tip.Ad }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-kanun">
                    <select class="form-control">
                        {% for kod, kanun in kanun_kodlari.items %}
                        <option value="{{ kod }}" {% if kod == '00000' %}selected{% endif %}>{{ kod }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-hy"><input type="checkbox" checked></div>
                <div class="col-bes"><input type="checkbox"></div>
            </div>

            <div class="yearly-row yearly-row-sgk">
                <div class="col-month"><strong>8. Ağustos</strong></div>
                <div class="col-sgk-tipi">
                    <select class="form-control">
                        {% for kod, tip in sgk_tipleri.items %}
                        <option value="{{ kod }}-{{ tip.Ad }}" {% if kod == '01' %}selected{% endif %}>{{ kod }}-{{ tip.Ad }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-kanun">
                    <select class="form-control">
                        {% for kod, kanun in kanun_kodlari.items %}
                        <option value="{{ kod }}" {% if kod == '00000' %}selected{% endif %}>{{ kod }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-hy"><input type="checkbox" checked></div>
                <div class="col-bes"><input type="checkbox"></div>
            </div>

            <div class="yearly-row yearly-row-sgk">
                <div class="col-month"><strong>9. Eylül</strong></div>
                <div class="col-sgk-tipi">
                    <select class="form-control">
                        {% for kod, tip in sgk_tipleri.items %}
                        <option value="{{ kod }}-{{ tip.Ad }}" {% if kod == '01' %}selected{% endif %}>{{ kod }}-{{ tip.Ad }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-kanun">
                    <select class="form-control">
                        {% for kod, kanun in kanun_kodlari.items %}
                        <option value="{{ kod }}" {% if kod == '00000' %}selected{% endif %}>{{ kod }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-hy"><input type="checkbox" checked></div>
                <div class="col-bes"><input type="checkbox"></div>
            </div>

            <div class="yearly-row yearly-row-sgk">
                <div class="col-month"><strong>10. Ekim</strong></div>
                <div class="col-sgk-tipi">
                    <select class="form-control">
                        {% for kod, tip in sgk_tipleri.items %}
                        <option value="{{ kod }}-{{ tip.Ad }}" {% if kod == '01' %}selected{% endif %}>{{ kod }}-{{ tip.Ad }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-kanun">
                    <select class="form-control">
                        {% for kod, kanun in kanun_kodlari.items %}
                        <option value="{{ kod }}" {% if kod == '00000' %}selected{% endif %}>{{ kod }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-hy"><input type="checkbox" checked></div>
                <div class="col-bes"><input type="checkbox"></div>
            </div>

            <div class="yearly-row yearly-row-sgk">
                <div class="col-month"><strong>11. Kasım</strong></div>
                <div class="col-sgk-tipi">
                    <select class="form-control">
                        {% for kod, tip in sgk_tipleri.items %}
                        <option value="{{ kod }}-{{ tip.Ad }}" {% if kod == '01' %}selected{% endif %}>{{ kod }}-{{ tip.Ad }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-kanun">
                    <select class="form-control">
                        {% for kod, kanun in kanun_kodlari.items %}
                        <option value="{{ kod }}" {% if kod == '00000' %}selected{% endif %}>{{ kod }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-hy"><input type="checkbox" checked></div>
                <div class="col-bes"><input type="checkbox"></div>
            </div>

            <div class="yearly-row yearly-row-sgk">
                <div class="col-month"><strong>12. Aralık</strong></div>
                <div class="col-sgk-tipi">
                    <select class="form-control">
                        {% for kod, tip in sgk_tipleri.items %}
                        <option value="{{ kod }}-{{ tip.Ad }}" {% if kod == '01' %}selected{% endif %}>{{ kod }}-{{ tip.Ad }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-kanun">
                    <select class="form-control">
                        {% for kod, kanun in kanun_kodlari.items %}
                        <option value="{{ kod }}" {% if kod == '00000' %}selected{% endif %}>{{ kod }}</option>
                        {% endfor %}
                    </select>
                </div>
                <div class="col-hy"><input type="checkbox" checked></div>
                <div class="col-bes"><input type="checkbox"></div>
            </div>
        </div>

        <div class="form-actions">
            <button type="button" class="btn-prev" onclick="showStep(2)">
                <i class="fas fa-arrow-left"></i> Önceki Adım
            </button>
            <button type="button" class="btn-calculate">
                <i class="fas fa-calculator"></i> Bordro Hesapla
            </button>
            <button type="button" class="btn-next" onclick="showStep(4)">
                Sonraki Adım <i class="fas fa-arrow-right"></i>
            </button>
        </div>
    </div>
</form>
            </div>

            <!-- ADIM 4: ÖZEL SİGORTALAR -->
            <div class="step-content" id="step4">
                <div class="form-header-bar">
                    <h2>Özel Sigortalar</h2>
                    <div class="header-right">
                        <select class="header-select">
                            <option>-</option>
                        </select>
                        <div class="action-buttons">
                            <button class="icon-btn green"><i class="fas fa-plus"></i></button>
                            <button class="icon-btn blue"><i class="fas fa-save"></i></button>
                            <button class="icon-btn yellow"><i class="fas fa-edit"></i></button>
                            <button class="icon-btn red"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                </div>

                <form class="modern-form">
                    <div class="form-section-content">
                        <div class="yearly-table">
                            <div class="yearly-header yearly-header-sigorta">
                                <div class="col-month">Ay</div>
                                <div class="col-sig">Sağ. Sig. İşçi</div>
                                <div class="col-sig">Sağ. Sig. İşv.</div>
                                <div class="col-sig">Hay. Sig. İşçi</div>
                                <div class="col-sig">Hay. Sig. İşv.</div>
                            </div>

                            <div class="yearly-row yearly-row-sigorta">
                                <div class="col-month"><strong>1. Ocak</strong></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                            </div>

                            <div class="yearly-row yearly-row-sigorta">
                                <div class="col-month"><strong>2. Şubat</strong></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                            </div>

                            <div class="yearly-row yearly-row-sigorta">
                                <div class="col-month"><strong>3. Mart</strong></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                            </div>

                            <div class="yearly-row yearly-row-sigorta">
                                <div class="col-month"><strong>4. Nisan</strong></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                            </div>

                            <div class="yearly-row yearly-row-sigorta">
                                <div class="col-month"><strong>5. Mayıs</strong></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                            </div>

                            <div class="yearly-row yearly-row-sigorta">
                                <div class="col-month"><strong>6. Haziran</strong></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                            </div>

                            <div class="yearly-row yearly-row-sigorta">
                                <div class="col-month"><strong>7. Temmuz</strong></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                            </div>

                            <div class="yearly-row yearly-row-sigorta">
                                <div class="col-month"><strong>8. Ağustos</strong></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                            </div>

                            <div class="yearly-row yearly-row-sigorta">
                                <div class="col-month"><strong>9. Eylül</strong></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                            </div>

                            <div class="yearly-row yearly-row-sigorta">
                                <div class="col-month"><strong>10. Ekim</strong></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                            </div>

                            <div class="yearly-row yearly-row-sigorta">
                                <div class="col-month"><strong>11. Kasım</strong></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                            </div>

                            <div class="yearly-row yearly-row-sigorta">
                                <div class="col-month"><strong>12. Aralık</strong></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                                <div class="col-sig"><input type="text" class="form-control" value="0,00 ₺"></div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-prev" onclick="showStep(3)">
                                <i class="fas fa-arrow-left"></i> Önceki Adım
                            </button>
                            <button type="button" class="btn-calculate">
                                <i class="fas fa-calculator"></i> Bordro Hesapla
                            </button>
                            <button type="button" class="btn-next" onclick="showStep(5)">
                                Sonraki Adım <i class="fas fa-arrow-right"></i>
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <!-- ADIM 5: FAZLA MESAİLER -->
            <div class="step-content" id="step5">
                <div class="form-header-bar">
                    <h2>Fazla Mesailer</h2>
                    <div class="header-right">
                        <select class="header-select">
                            <option>-</option>
                        </select>
                        <div class="action-buttons">
                            <button class="icon-btn green"><i class="fas fa-plus"></i></button>
                            <button class="icon-btn blue"><i class="fas fa-save"></i></button>
                            <button class="icon-btn yellow"><i class="fas fa-edit"></i></button>
                            <button class="icon-btn red"><i class="fas fa-trash"></i></button>
                        </div>
                    </div>
                </div>

                <form class="modern-form">
                    <div class="form-section-content">
                        <div class="yearly-table">
                            <div class="yearly-header yearly-header-fm">
                                <div class="col-month">Ay</div>
                                <div class="col-fm">FM01 (50 %)</div>
                                <div class="col-fm">FM02 (100 %)</div>
                                <div class="col-fm">FM03 (200 %)</div>
                            </div>

                            <div class="yearly-row yearly-row-fm">
                                <div class="col-month"><strong>1. Ocak</strong></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                            </div>

                            <div class="yearly-row yearly-row-fm">
                                <div class="col-month"><strong>2. Şubat</strong></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                            </div>

                            <div class="yearly-row yearly-row-fm">
                                <div class="col-month"><strong>3. Mart</strong></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                            </div>

                            <div class="yearly-row yearly-row-fm">
                                <div class="col-month"><strong>4. Nisan</strong></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                            </div>

                            <div class="yearly-row yearly-row-fm">
                                <div class="col-month"><strong>5. Mayıs</strong></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                            </div>

                            <div class="yearly-row yearly-row-fm">
                                <div class="col-month"><strong>6. Haziran</strong></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                            </div>

                            <div class="yearly-row yearly-row-fm">
                                <div class="col-month"><strong>7. Temmuz</strong></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                            </div>

                            <div class="yearly-row yearly-row-fm">
                                <div class="col-month"><strong>8. Ağustos</strong></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                            </div>

                            <div class="yearly-row yearly-row-fm">
                                <div class="col-month"><strong>9. Eylül</strong></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                            </div>

                            <div class="yearly-row yearly-row-fm">
                                <div class="col-month"><strong>10. Ekim</strong></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                            </div>

                            <div class="yearly-row yearly-row-fm">
                                <div class="col-month"><strong>11. Kasım</strong></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                            </div>

                            <div class="yearly-row yearly-row-fm">
                                <div class="col-month"><strong>12. Aralık</strong></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                                <div class="col-fm"><input type="text" class="form-control" value="0,00 saat"></div>
                            </div>
                        </div>

                        <div class="form-actions">
                            <button type="button" class="btn-prev" onclick="showStep(4)">
                                <i class="fas fa-arrow-left"></i> Önceki Adım
                            </button>
                            <button type="button" class="btn-calculate">
                                <i class="fas fa-calculator"></i> Bordro Hesapla
                            </button>
                        </div>
                    </div>
                </form>
            </div>

            <div id="sonuc-alani" style="display:none; margin-top: 30px;">
                <div class="form-header-bar">
                    <h2><i class="fas fa-check-circle" style="color: #28a745;"></i> Hesaplama Sonucu</h2>
                </div>

                <div style="background: #f8f9fa; border-radius: 8px; padding: 20px; margin-top: 15px;">
                    <h3 style="margin-bottom: 15px; color: #333;">📊 Yıllık Özet</h3>
                    <div id="yillik-ozet" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;"></div>
                </div>

                <details style="margin-top: 1rem;">
                    <summary style="cursor: pointer; color: #64748b; font-size: 0.9rem;">🔍 Detaylı Sonuç (JSON)</summary>
                    <pre id="json-sonuc" style="background: #1e293b; color: #e2e8f0; padding: 1rem; border-radius: 0.5rem; overflow-x: auto; font-size: 0.8rem; margin-top: 0.5rem; max-height: 500px; overflow-y: auto;"></pre>
                </details>
            </div>
        </div>
    </div>
</div>

<script>
function showStep(stepNumber) {
    document.querySelectorAll('.step-content').forEach(step => {
        step.classList.remove('active');
    });

    document.querySelectorAll('.nav-step').forEach(btn => {
        btn.classList.remove('active');
    });

    document.getElementById('step' + stepNumber).classList.add('active');
    document.querySelector('.nav-step[data-step="' + stepNumber + '"]').classList.add('active');

    window.scrollTo({ top: 0, behavior: 'smooth' });
}
</script>

<script>

function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

function parseTurkishNumber(value) {
    if (typeof value === 'number') return value;
    let s = String(value).trim();
    ['₺', 'TL', 'gün', 'saat', '%'].forEach(u => s = s.replace(u, ''));
    s = s.trim();
    if (!s) return 0;
    s = s.replace(/\./g, '').replace(',', '.');
    return parseFloat(s) || 0;
}

function collectFormData() {
    const data = { yil: 2026 };

    for (let ay = 1; ay <= 12; ay++) {
        const ayKey = `ay_${ay}`;
        data[ayKey] = {};
        const step1Rows = document.querySelectorAll('#step1 .yearly-row');
        if (step1Rows[ay - 1]) {
            const row = step1Rows[ay - 1];

            const brutInput = row.querySelector('.col-amount input');
            if (brutInput) data[ayKey].brut = parseTurkishNumber(brutInput.value);

            const engSelect = row.querySelector('.col-engellilik select');
            if (engSelect) {
                const v = engSelect.value;
                data[ayKey].engellilik = v.includes('1') ? 1 : v.includes('2') ? 2 : v.includes('3') ? 3 : 0;
            }
        }

        const step2Rows = document.querySelectorAll('#step2 .yearly-row-calisma');
        if (step2Rows[ay - 1]) {
            const row = step2Rows[ay - 1];

            const birAySelect = row.querySelector('.col-gun-sayisi select');
            if (birAySelect) data[ayKey].takvim_esasli = birAySelect.value === 'Takvim Günü';

            const gunInput = row.querySelector('.col-calisilan input');
            if (gunInput) data[ayKey].gun = parseTurkishNumber(gunInput.value);
        }

        const step3Rows = document.querySelectorAll('#step3 .yearly-row-sgk');
        if (step3Rows[ay - 1]) {
            const row = step3Rows[ay - 1];

            const sgkSelect = row.querySelector('.col-sgk-tipi select');
            if (sgkSelect) {
                const sgkCode = sgkSelect.value.split('-')[0].trim();
                data[ayKey].sgk_tipi = sgkCode;
            }

            const kanunSelect = row.querySelector('.col-kanun select');
            if (kanunSelect) data[ayKey].kanun_kodu = kanunSelect.value.split(' ')[0].trim();

            const besCheckbox = row.querySelector('.col-bes input[type="checkbox"]');
            if (besCheckbox) data[ayKey].bes_aktif = besCheckbox.checked;
        }
    }

    const ilkAy = data['ay_1'] || {};
    data.sgk_tipi = ilkAy.sgk_tipi || '01';
    data.kanun_kodu = ilkAy.kanun_kodu || '00000';
    data.bes_aktif = ilkAy.bes_aktif || false;
    data.engellilik_derecesi = ilkAy.engellilik || 0;
    data.takvim_esasli = ilkAy.takvim_esasli !== false;

    return data;
}

async function hesaplaVeYonlendir() {
    const overlay = document.createElement('div');
    overlay.id = 'loading-overlay';
    overlay.innerHTML = `
        <div style="background:white;padding:40px 60px;border-radius:12px;text-align:center;box-shadow:0 4px 20px rgba(0,0,0,0.3);">
            <i class="fas fa-spinner fa-spin" style="font-size:48px;color:#667eea;"></i>
            <p style="margin-top:20px;font-size:18px;color:#333;">Hesaplanıyor...</p>
        </div>
    `;
    overlay.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.5);display:flex;justify-content:center;align-items:center;z-index:9999;';
    document.body.appendChild(overlay);

    try {
        const formData = collectFormData();
        console.log('Gönderilen veri:', formData);

        const response = await fetch('{% url "yillik_hesapla_api" %}', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': getCookie('csrftoken')
            },
            body: JSON.stringify(formData)
        });

        const result = await response.json();
        console.log('Sonuç:', result);

        document.body.removeChild(overlay);

        if (result.success) {
            sonucGoster(result);
        } else {
            alert('Hesaplama hatası: ' + (result.error || 'Bilinmeyen hata'));
            console.error('Hata detayı:', result.traceback);
        }
    } catch (error) {
        const loadingOverlay = document.getElementById('loading-overlay');
        if (loadingOverlay) document.body.removeChild(loadingOverlay);
        console.error('Bağlantı hatası:', error);
        alert('Bağlantı hatası: ' + error.message);
    }
}

function sonucGoster(result) {
    const sonucAlani = document.getElementById('sonuc-alani');
    const yillikOzet = document.getElementById('yillik-ozet');
    const jsonSonuc = document.getElementById('json-sonuc');
    const ozet = result.sonuc.yillik_ozet || {};
    yillikOzet.innerHTML = `
        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; text-align: center;">
            <div style="font-size: 12px; color: #666;">Toplam Brüt</div>
            <div style="font-size: 18px; font-weight: bold; color: #1976d2;">${formatPara(ozet.toplam_brut)} ₺</div>
        </div>
        <div style="background: #e8f5e9; padding: 15px; border-radius: 8px; text-align: center;">
            <div style="font-size: 12px; color: #666;">Toplam Net</div>
            <div style="font-size: 18px; font-weight: bold; color: #388e3c;">${formatPara(ozet.toplam_net)} ₺</div>
        </div>
        <div style="background: #fff3e0; padding: 15px; border-radius: 8px; text-align: center;">
            <div style="font-size: 12px; color: #666;">Toplam Kesinti</div>
            <div style="font-size: 18px; font-weight: bold; color: #f57c00;">${formatPara(ozet.toplam_kesinti)} ₺</div>
        </div>
        <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; text-align: center;">
            <div style="font-size: 12px; color: #666;">İşveren Maliyeti</div>
            <div style="font-size: 18px; font-weight: bold; color: #7b1fa2;">${formatPara(ozet.toplam_isveren_maliyeti)} ₺</div>
        </div>
        <div style="background: #ffebee; padding: 15px; border-radius: 8px; text-align: center;">
            <div style="font-size: 12px; color: #666;">Toplam GV</div>
            <div style="font-size: 18px; font-weight: bold; color: #c62828;">${formatPara(ozet.toplam_gv)} ₺</div>
        </div>
        <div style="background: #e0f2f1; padding: 15px; border-radius: 8px; text-align: center;">
            <div style="font-size: 12px; color: #666;">Toplam SGK (İşçi)</div>
            <div style="font-size: 18px; font-weight: bold; color: #00796b;">${formatPara(ozet.toplam_sgk_personel)} ₺</div>
        </div>
    `;

    jsonSonuc.textContent = JSON.stringify(result.sonuc, null, 2);
    sonucAlani.style.display = 'block';
    sonucAlani.scrollIntoView({ behavior: 'smooth', block: 'start' });
}

function formatPara(sayi) {
    if (!sayi) return '0,00';
    return new Intl.NumberFormat('tr-TR', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(sayi);
}

function showStep(stepNumber) {
    document.querySelectorAll('.step-content').forEach(s => s.classList.remove('active'));
    document.querySelectorAll('.nav-step').forEach(b => b.classList.remove('active'));
    document.getElementById('step' + stepNumber).classList.add('active');
    document.querySelector('.nav-step[data-step="' + stepNumber + '"]').classList.add('active');
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

document.addEventListener('DOMContentLoaded', function() {
    document.querySelectorAll('.btn-calculate').forEach(btn => {
        btn.addEventListener('click', function(e) {
            e.preventDefault();
            hesaplaVeYonlendir();
        });
    });

    console.log('Yıllık hesaplama JS yüklendi');
});
</script>
{% endblock %}